docker_service_cpu: 512
docker_service_memory: 1024
docker_service_autoscaling_prod:
    service_metric: ALBRequestCountPerTarget
    target_value: 1800
docker_service_autoscaling: "{{ docker_service_autoscaling_prod if APIGEE_ENVIRONMENT in ('ref', 'prod') else dict() }}"
docker_service_health_check_grace_period_seconds: 180
docker_service:
    - name: eps-api-tool
      port: 9000
      expose: true
      environment:
          - name: LOG_LEVEL
            value: "{{ 'debug' if APIGEE_ENVIRONMENT == 'internal-dev' else 'info' }}"
          - name: COMMIT_ID
            value: "{{ SOURCE_COMMIT_ID }}"
          - name: ENVIRONMENT
            value: "{{ APIGEE_ENVIRONMENT }}"
          - name: DATABASE_URL
            value: "PLACEHOLDER"
          - name: DEMO_BASE_PATH
            value: "https://{{ APIGEE_HOSTNAME }}/{{ SERVICE_BASE_PATH }}"
          - name: EPS_BASE_PATH
            value: "https://{{ APIGEE_HOSTNAME }}/electronic-prescriptions/FHIR/R4"
          - name: OAUTH_BASE_PATH
            value: "https://{{ APIGEE_HOSTNAME }}/oauth2"
          - name: OAUTH_REDIRECT_URI
            value: "https://{{ APIGEE_HOSTNAME }}/{{ SERVICE_BASE_PATH }}/callback"
          - name: SIGNING_BASE_PATH
            value: "https://{{ APIGEE_HOSTNAME }}/signing-service"
      secrets:
          - name: DEMO_APP_CLIENT_ID
            valueFrom: "/{{ account }}/api-deployment/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/client-id"
          - name: DEMO_APP_KEY_ID
            valueFrom: "/{{ account }}/api-deployment/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/local-jwt-key-id"
          - name: RSS_JWT_ISSUER
            valueFrom: "/{{ account }}/api-deployment/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/rss-jwt-issuer"
          - name: RSS_JWT_KID
            valueFrom: "/{{ account }}/api-deployment/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/rss-jwt-key-id"
          - name: RSS_JWT_SUBJECT
            valueFrom: "/{{ account }}/api-deployment/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/rss-jwt-subject"
          - name: RSS_JWT_PRIVATE_KEY
            valueFrom: "/{{ account }}/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/rss-jwt-private-key"
          - name: DEMO_APP_PRIVATE_KEY
            valueFrom: "/{{ account }}/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/local-jwt-private-key"
          - name: DEMO_APP_CLIENT_SECRET
            valueFrom: "/{{ account }}/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/client-secret"
          - name: SESSION_TOKEN_ENCRYPTION_KEY
            valueFrom: "/{{ account }}/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/session-token-encryption-key"
      health_check:
          matcher: "200"
          path: "/_healthcheck"
